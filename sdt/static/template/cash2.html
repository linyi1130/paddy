<!DOCTYPE html>{% load static %}<html lang="zh"><head>    <meta charset="UTF-8">    <title>出纳台</title>    <!--<link rel="stylesheet" href="../semantic/semantic.min.css"> -->    <link rel="stylesheet" href="{% static 'semantic/semantic.css'%}"><script src="http://lib.baomitu.com/jquery/1.12.4/jquery.min.js"></script><script src="http://lib.baomitu.com/semantic-ui/2.2.13/semantic.min.js"></script></head><body><div id="sidebar" ></div><div class="dimmed pusher"><div class="ui labeled icon button" id="menu">		<i class="sidebar icon"></i>		导航		</div>    <div class="ui doubling stackable container" style="padding: auto">    <label class="right floated"><span class="ui tiny green header">{{ operator_name }}</span>/<span class="ui tiny brown header">{{ group_name }}</span>/<span class="ui tiny grey header">{{ club_name }}</span></label>      <div class="ui five item inverted menu">		<a class="item" id="a">出纳台</a>		<a class="item" id="b">玩家管理</a>		<a class="item" id="c">牌局管理</a>		<a class="item" id="d">实时报表</a>		<a class="item" id="e">俱乐部管理</a>		</div>    <div class="ui small modal" id="cash_message">        <h2 class="header">错误信息</h2>        <div class="content">            <p id="msg"></p>        </div>        <div class="actions">            <button class="ui negative button">返回</button>        </div>    </div>    <div class="ui small modal" id="confirm_cash_out">        <h2 class="header">确认</h2>        <div class="content">            <p id="msg2"></p>        </div>        <div class="actions">            <button class="ui positive button" onclick="cash_out()">确认</button>            <button class="ui negative button">返回</button>        </div>    </div>	<div class="ui horizontal divider">	玩家基本资料	</div>    	<div class="ui doubling stackable grid">    <div class="row">        <div class="four wide column">            <h3 class="ui orange header">                <i class="credit card alternative icon"></i>                <div class="content">                         出纳台                    <div class="sub orange header">充值与结算</div>                </div>            </h3>            <div name="account_list" id="account_list">                <div class="ui  form" name="cashform" id="cashform">                    <div class="field">                        <label for="user_id">请选择玩家</label>                        <select class="ui fluid search selection dropdown" onchange="getid()" name="user_id" id="user_id">                            <i class="dropdown icon"></i>                                <option class="item" value="">请选择玩家</option>                            {% for t in tb_user %}                                <option class="item" value={{ t.0 }},{{ t.1 }}>{{ t.7 }}</option>                            {% endfor %}                        </select>                    </div>                    <div class="ui field">                        <label for="op">操作金额</label>                        <input id="cash_num" type="text" name="cash_num" placeholder="请输入金额...">                    </div>                    <div class="ui field">                        <label for="pay_account">选择结算账户</label>                        <select class="ui fluid selection dropdown" id="pay_account" name="pay_account">                            <i class="dropdown icon"></i>                            <option value="">请选择操作账户</option>                            {% for t in tb_type_list %}                            <option value={{ t.account_id }}>{{ t.account_desc }}</option>                            {% endfor %}                        </select>                    </div>                <!--                    <div class="ui field">                        <div class="ui toggle large checkbox">                            <input type="checkbox" name="cashtype" id="cashtype">                            <label for="cashtype">是否结算</label>                        </div>                    </div>                -->                    <div class="ui field">                        <label for="note">备注</label>                        <input type="text" name="note" id="note">                    </div>                    <div class="ui hidden divider"></div>                    <button class="ui mini positive button " onclick="cash()">充值</button>                    <button class="ui mini right floated negative button" onclick="cash_out_check()">结算</button>                </div>            </div>            <div class="ui horizontal divider">客服账户信息</div>            <div id="club_account">            </div>        </div>        <div class="twelve wide column">            <div name="account" id="account">            </div>        </div>    </div>    </div>    </div></div><script>	$(document).ready(function(){	    $('.ui.dropdown').dropdown({            fullTextSearch:true        });        $("#sidebar").load('/loadsidebar/');		$("#menu").click(function(){		    $('.ui.sidebar').sidebar('toggle');	});        //$('#pay_account').find("option:contains('银行卡')").attr("selected",true);        $("#a").addClass('active red item');        $("#club_account").load("/club_account_info/");        //$("#club_account").load("{% static 'template/sidebar_account.html'%}")	}					 )</script><script>    $("#user_id").dropdown();    function getid() {        var struserinfo=$("#user_id").dropdown('get value');        var user_info=struserinfo.split(",");        var user_id=user_info[0];        var user_name=$("#user_id").dropdown('get text');        $('.ui.second.modal').remove();        $("#account").load("/useraccountview/",{"account_id":user_info[1],"user_name": user_name, "user_id":user_id});        $.ajaxSetup ({ cache: true });    }</script><script>function cash() {    $.ajaxSetup({async: false});    var message=$("#cashform").form('is valid');    if (message==true)       {var struserinfo=$("#user_id").dropdown('get value');        var user_info=struserinfo.split(",");        var user_id=user_info[0];        var account_id= user_info[1];        var change_num=$("#cash_num").val();        var note=$("#note").val();        var change_type=false;        var pay_account=$("#pay_account").dropdown('get value');        var user_name=$("#user_id").dropdown('get text');            {            $('.ui.second.modal').remove();            $("#account").load("/usercash/",{"user_id":user_id,'account_id':account_id,'change_num':change_num,                                        'change_type':change_type,'user_name':user_name,'note':note,'pay_account': pay_account});            $("#club_account").load("/club_account_info/");            $("#cash_num").val("");            $("#note").val("");}       }}function cash_out_check() {     $.ajaxSetup({async: false});    var message=$("#cashform").form('is valid');    if(message===true)    {        var account_type=$('#pay_account').dropdown('get text');        var user_name=$('#user_id').dropdown('get text');        var change_num=$("#cash_num").val();        var info="确认由("+account_type+")账户给玩家【"+user_name+"】结算"+change_num+"吗？";        //alert(info);        $('#msg2').text(info);        $('#confirm_cash_out').modal('show');    }}function check_developer_balance(user_id, change_num) {           var flag="";            $.ajax({               url:'/check_developer_balance_by_user/',               type:'post',               data:{'user_id':user_id,'change_num':change_num},               success:function (result) {                    flag=result;               }           });    if(flag==='True'){                return true    }    else {                return false    }}function cash_out() {    $('#cash_out_check').modal('hide');    var message=$("#cashform").form('is valid');    if (message==true)       {var struserinfo=$("#user_id").dropdown('get value');        var user_info=struserinfo.split(",");        var user_id=user_info[0];        var account_id= user_info[1];        var change_num=$("#cash_num").val();        var note=$("#note").val();        var change_type=true;        var pay_account=$("#pay_account").dropdown('get value');        var user_name=$("#user_id").dropdown('get text');            $.ajax({                url:'/check_balance/',                type:'post',                data:{'account_id':account_id, 'pay_account': pay_account, 'change_num':change_num,                    "user_id":user_id,'change_type':change_type,'user_name':user_name,'note':note},                success:function (msg) {                    if(msg=="1")                    {                        $('#msg').text("用户余额不足");                        $('#cash_message').modal('show')                    }                    else if(msg=="2")                    {                        $('#msg').text("指定账户余额不足");                        $('#cash_message').modal('show')                    }                    else {                        var flag=check_developer_balance(user_id,change_num);                        //alert(flag)                        if(flag===true) {                            $('.ui.second.modal').remove();                            $("#account").load("/usercash/", {                                "user_id": user_id,                                'account_id': account_id,                                'change_num': change_num,                                'change_type': change_type,                                'user_name': user_name,                                'note': note,                                'pay_account': pay_account                            });                            $("#club_account").load("/club_account_info/");                            $("#cash_num").val("");                            $("#note").val("");                            $('#confirm_cash_out').modal('hide')                        }                        else {                            $('#msg').text("托管俱乐部余额不足");                            $('#cash_message').modal('show')                        }                    }                }            })}}</script><script>$('#cashform').form({    on:'blur',    inline : true,    fields:{        cash_num:{          identifier :'cash_num',          rules:[{              type: 'empty',              prompt: '请输入金额'          },{              type:'regExp',              value : '/^(?!(0[0-9]{0,}$))[0-9]{1,}[.]{0,}[0-9]{0,}$/',              prompt:'请输入正数'          }          ]        },        user_id:{            identifier: 'user_id',            rules:[{                type:'empty',                prompt:'请选择玩家'            }]        },        pay_account:{            identifier: 'pay_account',            rules:[{                type:'empty',                prompt:'请选择操作账户'            }]        }    }})</script></body></html>