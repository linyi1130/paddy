<!DOCTYPE html>{% load static %}<html lang="zh"><head>    <meta charset="UTF-8">    <title>牌局管理</title>    <!--<link rel="stylesheet" href="../semantic/semantic.min.css">--><link rel="stylesheet" type="text/css" href="{% static 'css/style.css'%}" />    <link rel="stylesheet" href="{% static 'semantic/semantic.css'%}"><link href="http://lib.baomitu.com/datatables/1.10.16/css/dataTables.semanticui.css" rel="stylesheet"><link rel="stylesheet" href="{% static 'webuploader/webuploader.css'%}"><script src="http://lib.baomitu.com/jquery/1.12.4/jquery.min.js"></script><script src="http://lib.baomitu.com/datatables/1.10.16/js/jquery.dataTables.min.js"></script><script src="http://lib.baomitu.com/datatables/1.10.16/js/dataTables.semanticui.min.js"></script><script type="text/javascript" src="{% static 'webuploader/webuploader.js'%}"></script><script src="http://lib.baomitu.com/semantic-ui/2.2.13/semantic.min.js"></script></head><body><div id="sidebar" ></div><div class="dimmed pusher"><div class="ui labeled icon button" id="menu">		<i class="sidebar icon"></i>		导航    </div><div class="ui doubling stackable container" style="padding: 50px"><div class="ui five item inverted menu">		<a class="item" id="a">出纳台</a>		<a class="item" id="b">玩家管理</a>		<a class="item" id="c">牌局管理</a>		<a class="item" id="d">实时报表</a>		<a class="item" id="e">俱乐部管理</a>		</div>        <div class="ui horizontal divider">	    牌局管理	    </div><div id="content">    <table class="ui  small celled stackable striped table" id="subs_list">        <thead>            <tr>                <th>编号</th>                <th>游戏</th>                <th>盲注</th>                <th>straddle</th>                <th>开始时间</th>                <th>时长</th>                <th>状态</th>                <th>开局客服</th>                <th>操作</th>                <th>倒计时</th>            </tr>        </thead>        <tbody>            {% for t in table_list %}            <tr>                <td>{{ t.0 }}</td>                <td>{{ t.1 }}</td>                <td>{{ t.2 }}</td>                <td>{{ t.3 }}</td>                <td>{{ t.4 }}</td>                <td>{{ t.5 }}</td>                <td>{{ t.6 }}</td>                <td>{{ t.7 }}</td>                <td><div class="ui dropdown icon item">                    <i class="wrench icon"></i>                        <div class="menu">                        <div class="item" name="buy_in">带入</div>                        {% if permission_flag %}                        <div class="item" name="finish">结束</div>                        {% endif %}                        <div class="item" name="reward">奖励</div>                        {% if permission_flag %}                        <div class="item" name="abort">作废</div>                        {% endif %}                        </div>                    </div>                </td>                <td></td>              {% endfor %}            </tr>        </tbody>    </table>    <div>        <p id="count"></p>    </div>    <div class="ui scrolling  modal" id="buy" >        <i class="ui close icon"></i>        <h2 class="ui header">牌局编号</h2><label class="ui red ribbon label" id="game_no"></label>        <div class="scrolling content" id="buyin_reg">        </div>    </div>    <div class="ui small modal" id="warning" >        <i class="ui close icon"></i>        <h7 class="ui red icon header">            <i class="warning sign icon "></i>        </h7>        <div class="content">            <p id="warning_message"></p>        </div>        <div class="actions">            <div class="ui red basic cancel  button">            <i class="remove icon"></i>            取消            </div>            <button class="ui green ok button" onclick="reg()">            <i class="checkmark icon"></i>            确认            </button>  </div>    </div>    <div class="ui small modal" id="message">        <h2 class="header">错误信息</h2>        <div class="content">            <p id="msg"></p>        </div>        <div class="actions">            <button class="ui negative button" onclick="reflesh()">返回</button>        </div>    </div><div id="load_reward_modal"></div><script language="javascript" type="text/javascript">function leftTimer(year,month,day,hour,minute,second){  var leftTime = (new Date(year,month-1,day,hour,minute,second)) - (new Date()); //计算剩余的毫秒数  var days = parseInt(leftTime / 1000 / 60 / 60 / 24 , 10); //计算剩余的天数  var hours = parseInt(leftTime / 1000 / 60 / 60 % 24 , 10); //计算剩余的小时  var minutes = parseInt(leftTime / 1000 / 60 % 60, 10);//计算剩余的分钟  var seconds = parseInt(leftTime / 1000 % 60, 10);//计算剩余的秒数  days = checkTime(days);  hours = checkTime(hours);  minutes = checkTime(minutes);  seconds = checkTime(seconds);  //setInterval(leftTimer(2018,2,8,19,35,40),1000);  var text=hours + ":"  + minutes+":"+seconds  //alert(text)  return text}function checkTime(i){ //将0-9的数字前面加上0，例1变为01    if (i<=0)        return "00";  if(i<10)  {    i = "0" + i;  }  return i;}</script><script>    function countdown() {        $tr=$('#subs_list').find('tbody');        $('#subs_list tbody tr').each(function () {            var duration=parseInt($(this).find('td').eq(5).text());        var tmp=$(this).find('td').eq(4).text();        var tmp1=tmp.split(' ');        var tmp2=tmp1[1];        var tmp3=tmp2.split(':');         var hour=parseInt(tmp3[0]);         var min=parseInt(tmp3[1])+duration;         var date_str=tmp1[0];         var date=date_str.split('/');         var month=parseInt(date[0]);         var day=parseInt(date[1]);        var count=leftTimer(2018,month,day,hour,min,0);        $(this).find('td').eq(9).text(count);        if(count==='00:00:00')        {            $(this).addClass('negative')        }    })    }</script><script>	$(document).ready(function(){	    if($('#toc').length===0){	         $("#sidebar").load('/loadsidebar/');        }	    $('.ui.dropdown').dropdown();		$("#menu").click(function(){		    $('.ui.sidebar').sidebar('toggle');	});        $("#c").addClass('active red item');        //left_time();        //leftTimer();        setInterval(countdown,1000);        setInterval(reflesh,60000)	}					 );    $('.table tbody').on('click','tr td div[name=\'buy_in\']',function () {        //$.ajaxSetup({async: true});        var msg=$(this).parents("tr").find("td").eq(0).text();        $('#game_no').text(msg);        $('#buyin_reg').load('/table_reg_mini/ #content', {'gameno':msg},function (result) {            $result=$(result);            $result.find("script").appendTo('#content');            $('.modal').modal({            autofocus: false,            allowMultiple:true        });            if(result==='False')            {                $('#msg').text("该牌局已经导入，请刷新列表");                location.reload()            }            reg_check();            $('#buy').modal('show');        });    });    $('.table tbody').on('click','tr td div[name=\'abort\']',function () {        //$.ajaxSetup({async: true});        var gameno=$(this).parents("tr").find("td").eq(0).text();        $.ajax({            url:"/abortgame/",            type: 'post',            data: {'game_no': gameno},            success: function (result) {                location.reload()            }        })    });    $('.table tbody').on('click','tr td div[name=\'finish\']',function () {        var gameno=$(this).parents("tr").find("td").eq(0).text();        $.ajax({            url:'/getGameStatus/',            type:'post',            data:{'game_no':gameno},            success: function (result) {                if (result==="True")                {                    var url="/result"+"?game_no="+gameno;                    window.open(url)                }                else {                    $('#msg').text("该牌局已经导入，请刷新列表");                    $('#message').modal('show');                }            }        })        //$(top.location).attr("href","/result/","_blank")    });    function reflesh() {        var flag=$('.ui.modal').hasClass('visible');        //alert(flag)        if(flag){            return        }        location.reload()    };    $('.table tbody').on('click','tr td div[name=\'reward\']',function () {        if($('#reward_modal').length>0)        {            $('#reward_modal').remove()        }        var game_no=$(this).parents("tr").find("td").eq(0).text();        $('#load_reward_modal').load('/load_reward_modal/ #reward_modal',function (result) {            $('#reward_game_no').text(game_no);            $result=$(result);            $result.find('script').appendTo('#reward_modal');            $.ajax({             url:'/reward_normal_form/',             type:'post',             data:{'game_no': game_no},             datatype:'json',             success: function (result) {                 $('#reward_user').empty();                 $('#accountlist').empty();                 $('#rewardlist').empty();                 $('#reward_value').val("");                 if (result==='False')                 {                     alert('该牌局已经导入，请刷新列表');                     location.reload()                 }                 $.each(JSON.parse(result), function (key,value) {                     if (key==='user_list')                     {                         var tmp=value.toString();                         var userlist=tmp.split(",");                         var lenth=userlist.length;                         $('#reward_user').append('<option value="">请选择玩家</option>');                         for ( var t=0;t<lenth;t=t+3){                             var list='<option class="item" value='+ userlist[t] +','+userlist[t+1]+ '>' + userlist[t+2] + '</option>';                             $('#reward_user').append(list);                         }                     }                     if (key==='tb_reward')                     {                         var tmp=value.toString();                         var rewardlist=tmp.split(",");                         var lenth=rewardlist.length;                         $('#rewardlist').append('<option value="">选择牌型</option>')                         for ( var t=0;t<lenth;t=t+4){                             var list='<option class="item" value='+ rewardlist[t+1] + ','+rewardlist[t+2] + ','+rewardlist[t+3]+'>' + rewardlist[t] + '</option>';                             $('#rewardlist').append(list);                         }                     }                     if(key==='account_list')                     {                         var tmp=value.toString();                         var accountlist=tmp.split(",");                         var lenth=accountlist.length;                         for ( var t=0;t<lenth;t=t+2){                             var list='<option class="item" value='+ accountlist[t] + '>' + accountlist[t+1] + '</option>';                             $('#accountlist').append(list);                         }                     }                     $('#accountlist').find("option:contains('银行卡')").attr("selected",true);                     $('#reward_modal').modal({                         autofocus:false                     });                     $('#reward_modal').modal('show')                 })             }         })        });    })</script><script>$('#subs_list').DataTable({    destroy : true,    "lengthMenu" : [30,50,80,100],    "order":[[4,"desc"]],    "bAutoWidth":false,  responsive: true,  language: {      "sProcessing": "处理中...",      "sLengthMenu": "显示 _MENU_ 项结果",      "sZeroRecords": "没有匹配结果",      "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",      "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",      "sInfoFiltered": "(由 _MAX_ 项结果过滤)",      "sInfoPostFix": "",      "sSearch": "搜索:",      "sUrl": "",      "sEmptyTable": "表中数据为空",      "sLoadingRecords": "载入中...",      "sInfoThousands": ",",      "oPaginate": {          "sFirst": "首页",          "sPrevious": "上页",          "sNext": "下页",          "sLast": "末页"      },      "oAria": {          "sSortAscending": ": 以升序排列此列",          "sSortDescending": ": 以降序排列此列"      }  }})</script></div></div></div></body></html>